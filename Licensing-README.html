<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Licensing-README : README for Software Potential Licensing NuGet package from Software Potential" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Licensing-README</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/SoftwarePotential">View on GitHub</a>

          <h1 id="project_title">Licensing-README</h1>
          <h2 id="project_tagline">README for Software Potential Licensing NuGet package from Software Potential</h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>Welcome to the SoftwarePotential.Licensing-&lt;MyProduct&gt;_&lt;MyVersion&gt; NuGet Package for your Product</p>

<p>IMPORTANT: this package is intended to be used in concert with a SoftwarePotential.Protection-&lt;PermutationShortCode&gt; NuGet package, which must be installed for the code to compile correctly</p>

<p>NOTE: The code protection aspects of the Software Potential solution are covered in the <a href="http://softwarepotential.github.io/Protection-README.html">Licensing README</a> within the SoftwarePotential.Protection-&lt;PermutationShortCode&gt; NuGet Package for your Permutation</p>

<p>The code in this README is intended to provide a terse introduction to some key concepts employed in the Licensing APIs we expose.</p>

<p>It is NOT intended as a full product walkthrough or as a sample of a real application. Please refer to:</p>

<ul>
<li>
<a href="https://github.com/SoftwarePotentialsamples">https://github.com/SoftwarePotentialsamples</a> for example code</li>
<li>
<a href="http://support.inishtech.com">http://support.inishtech.com</a> for the forum and other support materials</li>
</ul><h1>
<a name="key-namespaces" class="anchor" href="#key-namespaces"><span class="octicon octicon-link"></span></a>KEY NAMESPACES</h1>

<pre><code>using Sp.Agent; // Most Sp.Agent licensing APIs live in this namespace
using Slps.ProtectionAttributes; // The [Protect] attribute lives in here
using System.Linq; // Many of our APIs yield collections etc. that are intended to work well with LINQ
</code></pre>

<h1>
<a name="attributes-for-protection-only-" class="anchor" href="#attributes-for-protection-only-"><span class="octicon octicon-link"></span></a>ATTRIBUTES FOR PROTECTION ONLY </h1>

<p>(Provided by accompanying SoftwarePotential.Protection NuGet Package)</p>

<h2>
<a name="0-protecting-code-" class="anchor" href="#0-protecting-code-"><span class="octicon octicon-link"></span></a>0. Protecting code </h2>

<div class="highlight"><pre><span class="c1">// (Actually provided by the SoftwarePotential.Protection NuGet Package, but commonly used together with License Checks)</span>
<span class="na">[Protect]</span> <span class="c1">// Protect the code (but no License checks)</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MySensitiveMethod</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Code Protector will Protect the method from ILDASM/ILSpy/Reflector etc. by transforming the code</span>
    <span class="c1">// No licensing restrictions are imposed on running this code</span>
    <span class="c1">// (This Attribute lives in Sp.Agent.dll in the namespace Slps.ProtectionAttributes - it is included in the Sp.Agent NuGet Package but it is typically installed via by the 'Sp.Protection-&lt;PermutationShortCode&gt; NuGet Package )</span>
<span class="p">}</span>
</pre></div>

<h1>
<a name="attributes-for-licensing-and-protection" class="anchor" href="#attributes-for-licensing-and-protection"><span class="octicon octicon-link"></span></a>ATTRIBUTES FOR LICENSING AND PROTECTION</h1>

<h2>
<a name="1-requiring-a-valid-product-license-to-run-some-code" class="anchor" href="#1-requiring-a-valid-product-license-to-run-some-code"><span class="octicon octicon-link"></span></a>1. Requiring a Valid product license to run some code</h2>

<div class="highlight"><pre><span class="na">[MyProduct_1.License]</span> <span class="c1">// Protect the code + require a license for the product</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MyMethodSubjectToHoldingAnyValidLicense</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Entry to this method is subject to a valid license for the product being available at each execution of the method</span>
    <span class="c1">// (as with [Protect], Code Protector will Protect the method)</span>
    <span class="c1">// (This Attribute is generated into a SpProduct.cs file by the 'Sp.Product-&lt;ProductName&gt;_&lt;ProductVersion&gt; NuGet Package)</span>
<span class="p">}</span>
</pre></div>

<h2>
<a name="2-requiring-a-specific-feature-from-the-software-potential-product-definition-to-be-available" class="anchor" href="#2-requiring-a-specific-feature-from-the-software-potential-product-definition-to-be-available"><span class="octicon octicon-link"></span></a>2. Requiring a specific Feature from the Software Potential Product Definition to be Available</h2>

<div class="highlight"><pre><span class="na">[MyProduct_1.Features.GlobalAnalysis]</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MyMethodSubjectToAvailabilityOfASpecificFeatureOnTheIssuedLicense</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Entry to this method is subject to the associated Product Feature being included in the Issued License</span>
    <span class="c1">// Both the License and the Feature must be Valid at the time of execution of the method</span>
    <span class="c1">// (as with [Protect], Code Protector will Protect the method)</span>
    <span class="c1">// (For each Feature that has been defined for the Product on the Software Potential Service, there will be an associated attribute generated into the SpProduct.cs file by the 'Sp.Product-&lt;ProductName&gt;_&lt;ProductVersion&gt; NuGet Package)</span>
<span class="p">}</span>
</pre></div>

<h1>
<a name="example-code-using-spagent-apis-to-implement-programmatic-license-checks" class="anchor" href="#example-code-using-spagent-apis-to-implement-programmatic-license-checks"><span class="octicon octicon-link"></span></a>EXAMPLE CODE USING Sp.Agent APIs TO IMPLEMENT PROGRAMMATIC LICENSE CHECKS</h1>

<h2>
<a name="1-querying-license-state" class="anchor" href="#1-querying-license-state"><span class="octicon octicon-link"></span></a>1. Querying License State</h2>

<div class="highlight"><pre><span class="c1">// Example using Sp.Agent APIs to programmatically determine whether a Licensing Requirement can be fulfilled</span>
<span class="c1">// The licensing check is enforced at the point where the Licensed behavior is actually triggered</span>
<span class="c1">// Here we use the API to enable buttons/menu items and/or offer tooltips or upgrade or 'buy now' links</span>
<span class="k">public</span> <span class="n">ScreenDefinition</span> <span class="nf">GenerateMenu</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// This single call will determine the set of currently available features this instant (including Feature Expiration checks etc.)</span>
    <span class="kt">var</span> <span class="n">features</span> <span class="p">=</span> <span class="n">SpAgent</span><span class="p">.</span><span class="n">Product</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">ValidAvailable</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">ScreenDefinition</span> <span class="p">{</span>
        <span class="k">new</span> <span class="nf">Title</span> <span class="p">(</span> <span class="s">"Main Menu"</span><span class="p">),</span>
        <span class="k">new</span> <span class="nf">Button</span> <span class="p">(</span> 
            <span class="s">"Run Report"</span><span class="p">,</span> 
            <span class="n">OnClick</span> <span class="p">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="n">ShowReportViewer</span><span class="p">(</span><span class="n">GenerateReport</span><span class="p">())),</span>
        <span class="k">new</span> <span class="nf">Button</span> <span class="p">(</span> 
            <span class="s">"Run Basic Check"</span><span class="p">,</span> 
            <span class="n">OnClick</span> <span class="p">=</span> <span class="n">MySensitiveMethod</span><span class="p">),</span>
        <span class="k">new</span> <span class="nf">Button</span> <span class="p">(</span> 
            <span class="s">"Run Detailed Analysis"</span><span class="p">,</span> 
            <span class="n">Enabled</span> <span class="p">=</span> <span class="n">features</span><span class="p">.</span><span class="n">Any</span><span class="p">(),</span>
            <span class="n">OnClick</span> <span class="p">=</span> <span class="n">MyMethodSubjectToHoldingAnyValidLicense</span><span class="p">),</span>
        <span class="k">new</span> <span class="nf">Button</span> <span class="p">(</span> 
            <span class="s">"Run Global Analysis"</span><span class="p">,</span> 
            <span class="n">Enabled</span> <span class="p">=</span> <span class="n">features</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span> <span class="n">MyProduct_1</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">GlobalAnalysis</span><span class="p">.</span><span class="n">Name</span> <span class="p">),</span>
            <span class="n">OnClick</span> <span class="p">=</span> <span class="n">MyMethodSubjectToAvailabilityOfASpecificFeatureOnTheIssuedLicense</span><span class="p">),</span>
        <span class="k">new</span> <span class="nf">Button</span> <span class="p">(</span> 
            <span class="s">"Run Global Optimization"</span><span class="p">,</span> 
            <span class="n">Enabled</span> <span class="p">=</span> <span class="n">features</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span> <span class="n">MyProduct_1</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">GlobalOptimization</span><span class="p">.</span><span class="n">Name</span> <span class="p">),</span>
            <span class="n">OnClick</span> <span class="p">=</span> <span class="n">StartGlobalOptimizationProcess</span><span class="p">)</span>
    <span class="p">};</span>
<span class="p">}</span>
</pre></div>

<h2>
<a name="2a-using-licensing-state-to-guide-application-flow" class="anchor" href="#2a-using-licensing-state-to-guide-application-flow"><span class="octicon octicon-link"></span></a>2a. Using Licensing State To Guide Application Flow</h2>

<div class="highlight"><pre><span class="c1">// Example of a case where the behavior of some logic needs to be aware of the Current Licensing state</span>
<span class="c1">// In this example, we have elected not to [Protect] this method. This might be on the basis that</span>
<span class="c1">// - the work we are performing is not intellectually sensitive </span>
<span class="c1">// - the code should run at peak performance. </span>
<span class="k">public</span> <span class="n">ReportOutput</span> <span class="nf">GenerateReport</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">GenerateBaseReportOutput</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">SpAgent</span><span class="p">.</span><span class="n">Product</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">ValidAvailableContains</span><span class="p">(</span> <span class="n">MyProduct_1</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">GlobalAnalysis</span><span class="p">.</span><span class="n">Name</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">data</span> <span class="p">=</span> <span class="n">LoadDataForGlobalAnalysis</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">10000</span><span class="p">;</span> <span class="n">i</span><span class="p">++</span> <span class="p">)</span>
            <span class="n">data</span><span class="p">.</span><span class="n">RunPreparationPass</span><span class="p">(</span> <span class="n">i</span> <span class="p">);</span>
        <span class="c1">// the method RunGlobalAnalysis will typically (directly or indirectly) contain Declarative License checks (i.e., as used on MyMethodSubjectToAvailabilityOfASpecificFeatureOnTheIssuedLicense) in relevant areas</span>
        <span class="n">result</span><span class="p">.</span><span class="n">AddAnalysis</span><span class="p">(</span> <span class="n">RunGlobalAnalysis</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h2>
<a name="2b-protecting-high-level-application-flow-logic" class="anchor" href="#2b-protecting-high-level-application-flow-logic"><span class="octicon octicon-link"></span></a>2b. Protecting High Level Application Flow Logic</h2>

<p>NOTE: If alternately one considered the logic in GenerateReport() (above) to be sensitive, one might</p>

<ol>
<li>Extract the section doing the 10000 iterations as another Method</li>
<li>
<p>Apply either one or the other of the following protection attributes</p>

<p>a) <strong>[Protect]</strong> - if you consider the general flow logic to be sensitive (but have placed appropriate License checks / attributes within code being triggered by this controlling logic) OR</p>

<p>b) <strong>[MyProduct_1.License]</strong> - if, in addition to (a) you also consider it critical that a Valid License is held to be able to run this controlling logic</p>
</li>
</ol><h2>
<a name="3-provisioningupgradingwarning-about-expiration-of-licenses-etc" class="anchor" href="#3-provisioningupgradingwarning-about-expiration-of-licenses-etc"><span class="octicon octicon-link"></span></a>3. Provisioning/Upgrading/Warning about Expiration of Licenses etc.</h2>

<div class="highlight"><pre><span class="c1">// Example of some basic logic using the Sp.Agent APIs to manage evaluations / purchases / upgrades of licenses for our product</span>
<span class="c1">// One should consider running this as an asynchronous or background activity, as the first call to a licensing routine in a cold application should ideally not unnecessarily impede the users flow</span>
<span class="na">[Protect]</span> <span class="c1">// Generally one would wish to Protect code such as this, as decompilation might unnecessarily leak information as to how your Licensing strategy as a whole works</span>
<span class="k">void</span> <span class="nf">CoordinateLicenseUpgrades</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//// Before this, one should have </span>
    <span class="c1">//// a) Configured and your License storage (typically during installation) </span>
    <span class="c1">//// b) Verified that License Storage is correctly configured</span>
    <span class="c1">//// The details of how this is coordinated depend on the specific Store and Application Type.</span>
    <span class="c1">//// See https://github.com/SoftwarePotential/samples for example code</span>
    <span class="kt">var</span> <span class="n">validLicenses</span> <span class="p">=</span> <span class="n">SpAgent</span><span class="p">.</span><span class="n">Product</span><span class="p">.</span><span class="n">Licenses</span><span class="p">.</span><span class="n">Valid</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">validLicenses</span><span class="p">.</span><span class="n">Any</span><span class="p">()</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">expiringFeatures</span> <span class="p">=</span> <span class="n">SpAgent</span><span class="p">.</span><span class="n">Product</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">ValidAvailableExpiringWithin</span><span class="p">(</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromDays</span><span class="p">(</span> <span class="m">30</span> <span class="p">)</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">expiringFeatures</span><span class="p">.</span><span class="n">Any</span><span class="p">()</span> <span class="p">)</span>
            <span class="n">TriggerLicensesExpiringWarningPage</span><span class="p">(</span> <span class="n">expiringFeatures</span><span class="p">,</span> <span class="n">validLicenses</span> <span class="p">);</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">userHasLicenseIncludingAdvancedFeature</span> <span class="p">=</span> <span class="n">SpAgent</span><span class="p">.</span><span class="n">Product</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">ValidAvailable</span><span class="p">().</span><span class="n">Contains</span><span class="p">(</span> <span class="n">MyProduct_1</span><span class="p">.</span><span class="n">Features</span><span class="p">.</span><span class="n">GlobalAnalysis</span><span class="p">.</span><span class="n">Name</span> <span class="p">);</span>
            <span class="n">TriggerStartupBannerWithTeaserForAdvancedModulesIfNotYetUpgraded</span><span class="p">(</span> <span class="n">userHasLicenseIncludingAdvancedFeature</span> <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="nf">TriggerNavigateToLicensePurchaseOrActivationScreen</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
